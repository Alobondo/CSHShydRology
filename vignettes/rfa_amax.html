<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>At-site flood frequency analysis using annual maximums</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">At-site flood frequency analysis using annual maximums</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this document I will show how to use <code>CSHShydRology</code> to perform at-site flood frequency analysis using annual maximums. First we will extract the annual maximums using the function <code>ExtractAmax</code> from the daily discharge of the Saint-John River at Fort Kent (NB). Note that incomplete years of data, i.e.Â with fewer than 365 days of observation are removed and a total 88 annual maximums are extracted.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(CSHShydRology)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">## Extract the annual maximums</span></a>
<a class="sourceLine" id="cb1-4" title="4">anData &lt;-<span class="st"> </span><span class="kw">ExtractAmax</span>(flow <span class="op">~</span><span class="st"> </span>date, flowStJohn, <span class="dt">tol =</span> <span class="dv">365</span>)</a></code></pre></div>
<p>The annual maximums are assumed to be independent and identically distributed. Risk is measured in terms of return period <span class="math inline">\(T\)</span> that characterizes the average waiting time separating two events of the same magnitude. In practice this is equivalent to evaluate the flood quantile associated with the probability <span class="math inline">\(p = 1-1/T\)</span>. The test of Mann-Kendall is frequently performed to verify if the data do not contain significant trends.</p>
</div>
<div id="estimation-of-the-flood-quantiles" class="section level2">
<h2>Estimation of the flood quantiles</h2>
<p>According to extreme value theory, as the number of annual maximums increase, their distribution converge to a Generalized Extreme Value (GEV) distribution <span class="math display">\[
F(x) = \exp\left\{ - \left[ 1 - \kappa \left(\frac{x-\xi}{\alpha} \right) 
  \right]^{1/\kappa} \right\}.
\]</span></p>
<p>The GEV distribution can be fitted using the <code>FitAmax</code> function as show in the example below. Here, the parameters are estimated using the maximum likelihood method. A summary of the estimated parameters, their standard deviations and the sample L-moments are returned.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">fitMle &lt;-<span class="st"> </span><span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, <span class="st">&#39;gev&#39;</span>, <span class="dt">method =</span> <span class="st">&#39;mle&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">print</span>(fitMle)</a></code></pre></div>
<pre><code>## 
## At-site frequency analysis
## 
## Distribution: gev 
## AIC: 1411 
## Method: mle
## Estimate:
##        xi     alpha     kappa 
## 2101.3761  668.9518    0.1667 
## 
## Std.err:
##       xi    alpha    kappa 
## 78.39437 54.31311  0.06214 
## 
## Lmoments:
##     l1  lcv     lsk    lkt
## 1 2390 0.17 0.05924 0.1399</code></pre>
<p>It is also possible to use the L-moment method to estimate the parameters. Note that by default <code>FitAmax</code> compute the covariance matrix of the parameters. For the maximum likelihood method, the covariance matrix is derived analytically from the the hessian matrix, while for the L-moment estimator a parametric bootstrap is used and a correction is made to ensure the positive definiteness of the matrix. The evaluation of the covariance matrix can be avoided by providing the arguments <code>varcov = FALSE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">## Fit GEV distribution using L-moments</span></a>
<a class="sourceLine" id="cb4-2" title="2">fitLmm &lt;-<span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, <span class="st">&#39;gev&#39;</span>, <span class="dt">method =</span> <span class="st">&#39;lmom&#39;</span>, <span class="dt">varcov =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The flood quantile of the GEV distribution can be obtained from the formula <span class="math display">\[
x_T = \mu + \frac{\alpha}{\xi}\left[ 1+\log(1/T)^\kappa \right] .
\]</span> These predictions are evaluated using the <code>predict</code> function. By default return period of 2, 5, 10, 20, 50 and 100 years are provided. The example below shows how to obtain the flood quantile of return periods 10 and 100 years using the argument <code>q = 1-1/T</code>. The standard deviation of the flood quantiles is estimated using the Delta method when requested by the argument <code>se = TRUE</code>. Similarly, confidence intervals are evaluated using the standard deviations by providing the argument <code>ci = &#39;delta&#39;</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">## Flood quantiles of 10 and 100 return periods</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">predict</span>(fitMle, <span class="dt">q =</span> <span class="kw">c</span>(.<span class="dv">9</span>,.<span class="dv">99</span>), <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">ci =</span> <span class="st">&#39;delta&#39;</span>, <span class="dt">alpha =</span> <span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##          pred       se    lower    upper
## 0.90 3356.637 117.7915 3162.888 3550.387
## 0.99 4250.404 238.4630 3858.167 4642.641</code></pre>
<p>confidence intervals can also be obtained using parametric bootstraps with the option <code>ci = &#39;boot&#39;</code>. This may be required if the normal approximation of the confidence intervals is realistic. The argument <code>out.matrix</code> requests that the bootstrap samples of the parameters and the flood quantiles be returned.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">out &lt;-<span class="st"> </span><span class="kw">predict</span>(fitLmm, <span class="dt">q =</span> <span class="kw">c</span>(.<span class="dv">9</span>,.<span class="dv">99</span>), <span class="dt">ci =</span> <span class="st">&#39;boot&#39;</span>, </a>
<a class="sourceLine" id="cb7-2" title="2">               <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">out.matrix =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">## Estimated Flood quantiles</span></a>
<a class="sourceLine" id="cb7-5" title="5">out<span class="op">$</span>pred</a></code></pre></div>
<pre><code>##          pred    lower    upper
## 0.90 3353.148 3112.853 3579.481
## 0.99 4215.448 3769.084 4842.902</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">## Bootstraps sample of model parameters</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">head</span>(out<span class="op">$</span>para)</a></code></pre></div>
<pre><code>##          [,1]     [,2]       [,3]
## [1,] 2198.886 694.3178 0.29491048
## [2,] 2045.032 509.8983 0.06180076
## [3,] 2190.424 684.1633 0.26932810
## [4,] 2065.349 699.4900 0.17976989
## [5,] 2059.068 763.4021 0.35657464
## [6,] 2141.801 869.8455 0.44253605</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## Bootstraps sample of flood quantiles</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">head</span>(out<span class="op">$</span>qua)</a></code></pre></div>
<pre><code>##          [,1]     [,2]
## [1,] 3340.821 3946.917
## [2,] 3116.273 4086.693
## [3,] 3345.020 3994.800
## [4,] 3359.980 4254.547
## [5,] 3240.346 3784.825
## [6,] 3381.299 3850.716</code></pre>
</div>
<div id="verification-of-the-model" class="section level2">
<h2>Verification of the model</h2>
<p>The return level plot provides a visual assessment of the fitted distribution by comparing the sampled and estimated flood quantiles. The graphic below shows a good agreement between the two. The confidence intervals are obtained using normal approximation based on the delta method.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co">## Return level plot</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(fitMle, <span class="dt">ci =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Another diagnostic is the goodness of fit test of Anderson-Darling that verifies if the observations were likely to be generated by a GEV distribution. A p-value superior to 0.05 indicates that the hypothesis of a GEV cannot be rejected at this significant level.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co">## Anderson-Darling goodness of fit test</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">GofTest</span>(fitLmm, <span class="dt">nsim =</span> <span class="dv">500</span>)</a></code></pre></div>
<pre><code>## 
## Goodness-of-fit test
##  
## Test = Anderson-Darling 
## Distribution = gev
## statistic : 0.2591 
## p-value : 0.48</code></pre>
</div>
<div id="selection-of-the-best-distribution" class="section level2">
<h2>Selection of the best distribution</h2>
<p>The GEV distribution is not the only distribution used in flood frequency analysis. Frequent alternative candidates are the shifted log-normal distribution (<code>&#39;ln3&#39;</code>), the Generalized logistic distribution (<code>&#39;glo&#39;</code>) and the Pearson type III distribution (<code>&#39;pe3&#39;</code>). These distribution can be fitted by the function <code>FitAmax</code> in the same way as the GEV.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">## </span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, <span class="st">&#39;ln3&#39;</span>, <span class="dt">method =</span> <span class="st">&#39;lmom&#39;</span>, <span class="dt">varcov =</span>  <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## 
## At-site frequency analysis
## 
## Distribution: ln3 
## AIC: 1411 
## Method: lmom
## Estimate:
##       zeta      mulog   sigmalog 
## -3552.1611     8.6825     0.1214 
## 
## Lmoments:
##     l1  lcv     lsk    lkt
## 1 2390 0.17 0.05924 0.1399</code></pre>
<p>A best distribution can be selected using the Akaike Information Criterion (AIC) as returned by the function <code>AIC</code>. However, the process of selecting the best ditribution can be automatized, by passing a list of distribution. In this exemple below, all candidates have similar AIC, which indicates that all distributions represent reasonable choices. The argument <code>tol.gev</code> can be used to ensure that the selected candidate has a AIC greater than the GEV distribution by a given margin, otherwise GEV will be prefered.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co">## Candidates distribution</span></a>
<a class="sourceLine" id="cb18-2" title="2">candidates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;gev&#39;</span>,<span class="st">&#39;glo&#39;</span>,<span class="st">&#39;ln3&#39;</span>,<span class="st">&#39;pe3&#39;</span>)</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co">## Function that compute the AIC for a given distribution</span></a>
<a class="sourceLine" id="cb18-5" title="5">FAIC &lt;-<span class="st"> </span><span class="cf">function</span>(d)</a>
<a class="sourceLine" id="cb18-6" title="6">   <span class="kw">AIC</span>(<span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, d, <span class="dt">method =</span> <span class="st">&#39;mle&#39;</span>, <span class="dt">varcov =</span>  <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="co">## AIC of all distribution</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="kw">sapply</span>(candidates, FAIC)</a></code></pre></div>
<pre><code>##      gev      glo      ln3      pe3 
## 1411.247 1412.612 1411.144 1411.133</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co">## Automatic selection of the distribution</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">FitAmax</span>(anData<span class="op">$</span>flow, candidates, <span class="dt">method =</span> <span class="st">&#39;mle&#39;</span>, <span class="dt">tol.gev =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## 
## At-site frequency analysis
## 
## Distribution: gev 
## AIC: 1411 
## Method: mle
## Estimate:
##        xi     alpha     kappa 
## 2101.3761  668.9518    0.1667 
## 
## Std.err:
##       xi    alpha    kappa 
## 78.39437 54.31311  0.06214 
## 
## Lmoments:
##     l1  lcv     lsk    lkt
## 1 2390 0.17 0.05924 0.1399</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>In this document we showed how to evaluate flood quantiles using annual maximum river discharge. Initially, the extraction of the annual maximums (<code>ExtractAmax</code>) was discussed. Instructions were provided to estimate (<code>FitAmax</code>) the model for different distributions and to select a best distribution using the AIC (<code>FitAmax.auto</code>). The function to obtain the flood quantiles and their uncertainties (<code>predict</code>) was presented. Finally, the return level plot (<code>plot</code>) was presented as a common way to visualize the quality of the fitting and goodness of fit test were discussed. For a general introduction to the technical aspect of modeling annual maximums, the readers are referred to Coles (2001) or Hosking and Wallis (1997).</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Coles, S., 2001. An introduction to statistical modeling of extreme values. Springer Verlag.</p>
<p>Hosking, J.R.M., Wallis, J.R., 1997. Regional frequency analysis: an approach based on L-moments. Cambridge Univ Pr.</p>
<p>ÃnÃ¶z, B., Bayazit, M., 2012. Block bootstrap for MannâKendall trend test of serially dependent data. Hydrol. Process. 26, 3552â3560. <a href="https://doi.org/10.1002/hyp.8438" class="uri">https://doi.org/10.1002/hyp.8438</a></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
